<!-- pages/records/records.wxml -->
<view class="records-container">
  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tab-bar">
    <view class="tab-item {{activeTab === 'exam' ? 'active' : ''}}" bindtap="switchTab" data-tab="exam">
      <text class="tab-text">éªŒå…‰æ¡£æ¡ˆ</text>
      <view class="tab-indicator" wx:if="{{activeTab === 'exam'}}"></view>
    </view>
    <view class="tab-item {{activeTab === 'self' ? 'active' : ''}}" bindtap="switchTab" data-tab="self">
      <text class="tab-text">è‡ªæµ‹è®°å½•</text>
      <view class="tab-indicator" wx:if="{{activeTab === 'self'}}"></view>
    </view>
  </view>

  <!-- éªŒå…‰æ¡£æ¡ˆ -->
  <view class="exam-records" wx:if="{{activeTab === 'exam'}}">
    <!-- æœ€æ–°éªŒå…‰ç»“æœ -->
    <view class="latest-record card" wx:if="{{latestExam}}">
      <view class="card-header">
        <text class="card-title">ğŸ“‹ æœ€æ–°éªŒå…‰ç»“æœ</text>
        <text class="exam-date">{{latestExam.examDate}}</text>
      </view>
      <view class="exam-details">
        <view class="eye-data">
          <view class="eye-section">
            <text class="eye-label">å³çœ¼ (OD)</text>
            <view class="data-row">
              <view class="data-item">
                <text class="data-label">çƒé•œ</text>
                <text class="data-value">{{latestExam.rightEye.sphere}}</text>
              </view>
              <view class="data-item">
                <text class="data-label">æŸ±é•œ</text>
                <text class="data-value">{{latestExam.rightEye.cylinder}}</text>
              </view>
              <view class="data-item">
                <text class="data-label">è½´ä½</text>
                <text class="data-value">{{latestExam.rightEye.axis}}Â°</text>
              </view>
            </view>
          </view>
          <view class="eye-section">
            <text class="eye-label">å·¦çœ¼ (OS)</text>
            <view class="data-row">
              <view class="data-item">
                <text class="data-label">çƒé•œ</text>
                <text class="data-value">{{latestExam.leftEye.sphere}}</text>
              </view>
              <view class="data-item">
                <text class="data-label">æŸ±é•œ</text>
                <text class="data-value">{{latestExam.leftEye.cylinder}}</text>
              </view>
              <view class="data-item">
                <text class="data-label">è½´ä½</text>
                <text class="data-value">{{latestExam.leftEye.axis}}Â°</text>
              </view>
            </view>
          </view>
        </view>
        <view class="exam-meta">
          <text class="meta-item">ç³è·ï¼š{{latestExam.pd}}mm</text>
          <text class="meta-item">éªŒå…‰å¸ˆï¼š{{latestExam.optometrist}}</text>
        </view>
        <view class="exam-note" wx:if="{{latestExam.note}}">
          <text class="note-label">å¤‡æ³¨ï¼š</text>
          <text class="note-text">{{latestExam.note}}</text>
        </view>
      </view>
    </view>

    <!-- å†å²è®°å½• -->
    <view class="history-section" wx:if="{{examHistory.length > 0}}">
      <view class="section-header">
        <text class="section-title">å†å²éªŒå…‰è®°å½•</text>
      </view>
      <view class="history-list">
        <view class="history-item card" wx:for="{{examHistory}}" wx:key="_id" bindtap="viewExamDetail" data-id="{{item._id}}">
          <view class="history-header">
            <text class="history-date">{{item.examDate}}</text>
            <text class="history-optometrist">éªŒå…‰å¸ˆï¼š{{item.optometrist}}</text>
          </view>
          <view class="history-brief">
            <text>å³çœ¼: {{item.rightEye.sphere}} / å·¦çœ¼: {{item.leftEye.sphere}}</text>
          </view>
          <view class="view-more">
            <text>æŸ¥çœ‹è¯¦æƒ… ></text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!latestExam && examHistory.length === 0}}">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-title">æš‚æ— éªŒå…‰è®°å½•</text>
      <text class="empty-tip">æ‚¨è¿˜æ²¡æœ‰åœ¨åº—å†…åšè¿‡éªŒå…‰æ£€æŸ¥</text>
    </view>
  </view>

  <!-- è‡ªæµ‹è®°å½• -->
  <view class="self-records" wx:if="{{activeTab === 'self'}}">
    <view class="self-record card" wx:if="{{selfTestRecord}}">
      <view class="card-header">
        <text class="card-title">ğŸ‘ï¸ æœ€è¿‘ä¸€æ¬¡è‡ªæµ‹ç»“æœ</text>
        <text class="test-date">{{selfTestRecord.testDate}}</text>
      </view>
      <view class="self-details">
        <view class="result-item">
          <text class="result-label">æµ‹è¯•çœ¼ç›</text>
          <text class="result-value">{{selfTestRecord.eyeText}}</text>
        </view>
        <view class="result-item">
          <text class="result-label">è§†åŠ›ç­‰çº§</text>
          <text class="result-value highlight">{{selfTestRecord.visionLevel}}</text>
        </view>
        <view class="result-item">
          <text class="result-label">æ­£ç¡®ç‡</text>
          <text class="result-value">{{selfTestRecord.correctRate}}%</text>
        </view>
        <view class="result-item">
          <text class="result-label">æµ‹è¯•ç”¨æ—¶</text>
          <text class="result-value">{{selfTestRecord.testTime}}</text>
        </view>
      </view>
      <view class="test-tip">
        <text>* è‡ªæµ‹ç»“æœä»…ä¾›å‚è€ƒï¼Œå»ºè®®å®šæœŸåˆ°åº—è¿›è¡Œä¸“ä¸šéªŒå…‰</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!selfTestRecord}}">
      <text class="empty-icon">ğŸ‘ï¸</text>
      <text class="empty-title">æš‚æ— è‡ªæµ‹è®°å½•</text>
      <text class="empty-tip">å¿«å»é¦–é¡µè¿›è¡Œè§†åŠ›æµ‹è¯•å§</text>
      <button class="action-btn" bindtap="goToVisionTest">å¼€å§‹æµ‹è¯•</button>
    </view>

    <!-- æ¸©é¦¨æç¤º -->
    <view class="tips-card card" wx:if="{{selfTestRecord}}">
      <view class="card-header">
        <text class="card-title">ğŸ’¡ æ¸©é¦¨æç¤º</text>
      </view>
      <view class="tips-content">
        <text class="tip-item">â€¢ å»ºè®®æ¯éš”3-6ä¸ªæœˆè¿›è¡Œä¸€æ¬¡ä¸“ä¸šéªŒå…‰</text>
        <text class="tip-item">â€¢ å¦‚å‘ç°è§†åŠ›å˜åŒ–æ˜æ˜¾ï¼Œè¯·åŠæ—¶å°±åŒ»</text>
        <text class="tip-item">â€¢ æ³¨æ„ç”¨çœ¼å«ç”Ÿï¼Œé¿å…é•¿æ—¶é—´ä½¿ç”¨ç”µå­è®¾å¤‡</text>
      </view>
    </view>
  </view>
</view>
