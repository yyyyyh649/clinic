<!-- pages/staff/recharge/recharge.wxml -->
<view class="recharge-container">
  <!-- å®¢æˆ·ä¿¡æ¯ -->
  <view class="customer-section" wx:if="{{customer}}">
    <view class="customer-card">
      <view class="customer-avatar">{{customer.name ? customer.name[0] : 'å®¢'}}</view>
      <view class="customer-info">
        <text class="customer-name">{{customer.name || 'æœªè®¾ç½®å§“å'}}</text>
        <text class="customer-phone">{{customer.phone}}</text>
      </view>
      <view class="current-balance">
        <text class="balance-label">å½“å‰ä½™é¢</text>
        <text class="balance-value">Â¥{{customer.balance}}</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢å®¢æˆ· -->
  <view class="search-section" wx:if="{{!customer}}">
    <view class="search-bar">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        type="number" 
        maxlength="11"
        placeholder="è¾“å…¥æ‰‹æœºå·æœç´¢å®¢æˆ·" 
        bindinput="onPhoneInput"
        bindconfirm="searchCustomer"
        value="{{searchPhone}}"
      />
    </view>
    <button class="search-btn" bindtap="searchCustomer">æœç´¢</button>
  </view>

  <!-- å……å€¼è¡¨å• -->
  <view class="recharge-form" wx:if="{{customer}}">
    <!-- å……å€¼å¥—é¤ -->
    <view class="packages-section">
      <view class="section-header">
        <text class="section-title">ğŸ’ å……å€¼å¥—é¤</text>
      </view>
      <view class="packages-grid">
        <view class="package-item {{selectedPackage === index ? 'selected' : ''}}" 
              wx:for="{{packages}}" wx:key="id"
              bindtap="selectPackage" data-index="{{index}}">
          <text class="package-amount">Â¥{{item.amount}}</text>
          <text class="package-gift" wx:if="{{item.gift > 0}}">é€Â¥{{item.gift}}</text>
          <text class="package-total">åˆ°è´¦Â¥{{item.total}}</text>
        </view>
      </view>
    </view>

    <!-- è‡ªå®šä¹‰é‡‘é¢ -->
    <view class="custom-section">
      <view class="section-header">
        <text class="section-title">ğŸ’° è‡ªå®šä¹‰é‡‘é¢</text>
      </view>
      <view class="amount-input-wrapper">
        <text class="currency">Â¥</text>
        <input 
          class="amount-input" 
          type="digit" 
          placeholder="è¯·è¾“å…¥å……å€¼é‡‘é¢" 
          bindinput="onAmountInput"
          bindfocus="onAmountFocus"
          value="{{customAmount}}"
        />
      </view>
      <view class="amount-tips">
        <text>å……å€¼é‡‘é¢ï¼šÂ¥{{rechargeAmount}}</text>
        <text wx:if="{{giftAmount > 0}}"> + èµ é€ï¼šÂ¥{{giftAmount}}</text>
        <text class="total-text"> = åˆ°è´¦ï¼šÂ¥{{totalAmount}}</text>
      </view>
    </view>

    <!-- æ”¶æ¬¾æ–¹å¼ -->
    <view class="payment-section">
      <view class="section-header">
        <text class="section-title">ğŸ’³ æ”¶æ¬¾æ–¹å¼</text>
      </view>
      <view class="payment-options">
        <view class="payment-item {{paymentMethod === 'cash' ? 'selected' : ''}}" 
              bindtap="selectPayment" data-method="cash">
          <text class="payment-icon">ğŸ’µ</text>
          <text class="payment-name">ç°é‡‘</text>
        </view>
        <view class="payment-item {{paymentMethod === 'wechat' ? 'selected' : ''}}" 
              bindtap="selectPayment" data-method="wechat">
          <text class="payment-icon">ğŸ’¬</text>
          <text class="payment-name">å¾®ä¿¡</text>
        </view>
        <view class="payment-item {{paymentMethod === 'alipay' ? 'selected' : ''}}" 
              bindtap="selectPayment" data-method="alipay">
          <text class="payment-icon">ğŸ“±</text>
          <text class="payment-name">æ”¯ä»˜å®</text>
        </view>
        <view class="payment-item {{paymentMethod === 'card' ? 'selected' : ''}}" 
              bindtap="selectPayment" data-method="card">
          <text class="payment-icon">ğŸ’³</text>
          <text class="payment-name">åˆ·å¡</text>
        </view>
      </view>
    </view>

    <!-- å¤‡æ³¨ -->
    <view class="remark-section">
      <view class="section-header">
        <text class="section-title">ğŸ“ å¤‡æ³¨</text>
      </view>
      <input 
        class="remark-input" 
        type="text" 
        placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰"
        bindinput="onRemarkInput"
        value="{{remark}}"
      />
    </view>

    <!-- å……å€¼ç¡®è®¤ -->
    <view class="confirm-section">
      <view class="confirm-summary">
        <view class="summary-row">
          <text class="summary-label">å……å€¼é‡‘é¢</text>
          <text class="summary-value">Â¥{{rechargeAmount}}</text>
        </view>
        <view class="summary-row" wx:if="{{giftAmount > 0}}">
          <text class="summary-label">èµ é€é‡‘é¢</text>
          <text class="summary-value gift">+Â¥{{giftAmount}}</text>
        </view>
        <view class="summary-row total">
          <text class="summary-label">åˆ°è´¦é‡‘é¢</text>
          <text class="summary-value">Â¥{{totalAmount}}</text>
        </view>
      </view>
      <button class="confirm-btn" bindtap="confirmRecharge">ç¡®è®¤å……å€¼</button>
    </view>
  </view>
</view>
