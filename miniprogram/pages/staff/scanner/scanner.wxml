<!-- pages/staff/scanner/scanner.wxml -->
<view class="scanner-container">
  <!-- æ‰«ç åŒºåŸŸ -->
  <view class="scan-section">
    <camera 
      class="camera" 
      device-position="back" 
      flash="off" 
      binderror="onCameraError"
      wx:if="{{showCamera}}"
    >
      <cover-view class="scan-frame">
        <cover-view class="corner top-left"></cover-view>
        <cover-view class="corner top-right"></cover-view>
        <cover-view class="corner bottom-left"></cover-view>
        <cover-view class="corner bottom-right"></cover-view>
      </cover-view>
      <cover-view class="scan-tip">å°†å®¢æˆ·äºŒç»´ç æ”¾å…¥æ¡†å†…æ‰«æ</cover-view>
    </camera>
    
    <view class="camera-placeholder" wx:else>
      <text class="placeholder-icon">ğŸ“·</text>
      <text class="placeholder-text">ç›¸æœºæœªæˆæƒ</text>
      <button class="auth-btn" bindtap="requestCameraAuth">æˆæƒç›¸æœº</button>
    </view>
  </view>

  <!-- æ‰«ç æŒ‰é’® -->
  <view class="action-section">
    <button class="scan-btn" bindtap="startScan">
      <text class="scan-icon">ğŸ“±</text>
      <text>æ‰«æäºŒç»´ç </text>
    </button>
  </view>

  <!-- æ‰«ç ç»“æœ -->
  <view class="result-section" wx:if="{{scanResult}}">
    <view class="result-card">
      <view class="result-header">
        <text class="result-title">æ‰«ç ç»“æœ</text>
        <view class="close-btn" bindtap="clearResult">Ã—</view>
      </view>
      
      <!-- å®¢æˆ·ä¿¡æ¯ -->
      <view class="customer-info">
        <view class="info-row">
          <text class="info-label">å®¢æˆ·å§“å</text>
          <text class="info-value">{{scanResult.customerName}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">æ‰‹æœºå·</text>
          <text class="info-value">{{scanResult.phone}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">ä¼šå‘˜ä½™é¢</text>
          <text class="info-value balance">Â¥{{scanResult.balance}}</text>
        </view>
      </view>

      <!-- å¯ç”¨å¥–å“ -->
      <view class="prizes-section" wx:if="{{scanResult.prizes.length > 0}}">
        <text class="section-label">å¯ç”¨å¥–å“</text>
        <view class="prize-list">
          <view class="prize-item {{item.selected ? 'selected' : ''}}" 
                wx:for="{{scanResult.prizes}}" wx:key="_id"
                bindtap="togglePrize" data-index="{{index}}">
            <view class="prize-check">{{item.selected ? 'âœ“' : ''}}</view>
            <text class="prize-icon">{{item.icon}}</text>
            <text class="prize-name">{{item.name}}</text>
          </view>
        </view>
      </view>

      <!-- æ‰£é™¤é‡‘é¢ -->
      <view class="deduct-section">
        <text class="section-label">æ‰£é™¤é‡‘é¢</text>
        <view class="amount-input-wrapper">
          <text class="currency">Â¥</text>
          <input 
            class="amount-input" 
            type="digit" 
            placeholder="è¯·è¾“å…¥é‡‘é¢" 
            bindinput="onAmountInput"
            value="{{deductAmount}}"
          />
        </view>
        <view class="amount-tips">
          <text>å¯æ‰£ä½™é¢ï¼šÂ¥{{scanResult.balance}}</text>
        </view>
      </view>

      <!-- æ¶ˆè´¹å¤‡æ³¨ -->
      <view class="remark-section">
        <text class="section-label">æ¶ˆè´¹å¤‡æ³¨</text>
        <input 
          class="remark-input" 
          type="text" 
          placeholder="è¯·è¾“å…¥æ¶ˆè´¹è¯´æ˜ï¼ˆé€‰å¡«ï¼‰" 
          bindinput="onRemarkInput"
          value="{{remark}}"
        />
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <button class="cancel-btn" bindtap="clearResult">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="confirmVerify">ç¡®è®¤æ ¸é”€</button>
      </view>
    </view>
  </view>

  <!-- æ“ä½œè®°å½• -->
  <view class="history-section" wx:if="{{recentRecords.length > 0}}">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘æ“ä½œ</text>
    </view>
    <view class="history-list">
      <view class="history-item" wx:for="{{recentRecords}}" wx:key="_id">
        <view class="history-info">
          <text class="history-customer">{{item.customerName}}</text>
          <text class="history-desc">{{item.description}}</text>
        </view>
        <view class="history-meta">
          <text class="history-amount">{{item.amount ? '-Â¥' + item.amount : ''}}</text>
          <text class="history-time">{{item.time}}</text>
        </view>
      </view>
    </view>
  </view>
</view>
