<!-- pages/admin/customer-management/customer-management.wxml -->
<view class="customer-management-container">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        type="text" 
        placeholder="æœç´¢å®¢æˆ·å§“åæˆ–æ‰‹æœºå·" 
        bindinput="onSearchInput"
        bindconfirm="doSearch"
        value="{{searchKeyword}}"
      />
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section">
    <view class="stat-card">
      <text class="stat-value">{{totalCustomers}}</text>
      <text class="stat-label">æ€»å®¢æˆ·æ•°</text>
    </view>
    <view class="stat-card">
      <text class="stat-value">Â¥{{totalBalance}}</text>
      <text class="stat-label">æ€»ä½™é¢</text>
    </view>
  </view>

  <!-- å®¢æˆ·åˆ—è¡¨ -->
  <view class="customer-list" wx:if="{{customers.length > 0}}">
    <view class="customer-item" wx:for="{{customers}}" wx:key="_id" bindtap="viewCustomerDetail" data-customer="{{item}}">
      <view class="customer-avatar">{{item.name ? item.name[0] : 'å®¢'}}</view>
      <view class="customer-info">
        <text class="customer-name">{{item.name || 'æœªè®¾ç½®å§“å'}}</text>
        <text class="customer-phone">{{item.phone}}</text>
      </view>
      <view class="customer-stats">
        <text class="balance">Â¥{{item.balance}}</text>
        <text class="exam-count">{{item.examCount}}æ¬¡éªŒå…‰</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{customers.length === 0 && !isLoading}}">
    <text class="empty-icon">ğŸ‘¥</text>
    <text class="empty-text">æš‚æ— å®¢æˆ·æ•°æ®</text>
  </view>

  <!-- å®¢æˆ·è¯¦æƒ…å¼¹çª— -->
  <view class="detail-modal" wx:if="{{showDetail}}" bindtap="closeDetail">
    <view class="detail-content" catchtap="">
      <view class="detail-header">
        <text class="detail-title">å®¢æˆ·è¯¦æƒ…</text>
        <view class="close-btn" bindtap="closeDetail">Ã—</view>
      </view>
      
      <view class="detail-body">
        <view class="info-section">
          <view class="info-row">
            <text class="info-label">å§“å</text>
            <text class="info-value">{{currentCustomer.name || 'æœªè®¾ç½®'}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æ‰‹æœºå·</text>
            <text class="info-value">{{currentCustomer.phone}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">ä¼šå‘˜ä½™é¢</text>
            <text class="info-value balance">Â¥{{currentCustomer.balance}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">ç§¯åˆ†</text>
            <text class="info-value">{{currentCustomer.points}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">éªŒå…‰æ¬¡æ•°</text>
            <text class="info-value">{{currentCustomer.examCount}}æ¬¡</text>
          </view>
          <view class="info-row">
            <text class="info-label">æ³¨å†Œæ—¶é—´</text>
            <text class="info-value">{{currentCustomer.registerTime}}</text>
          </view>
        </view>

        <!-- æœ€è¿‘éªŒå…‰è®°å½• -->
        <view class="exam-section" wx:if="{{currentCustomer.latestExam}}">
          <text class="section-title">æœ€è¿‘éªŒå…‰</text>
          <view class="exam-card">
            <view class="exam-date">{{currentCustomer.latestExam.date}}</view>
            <view class="exam-data">
              <text>å³çœ¼: {{currentCustomer.latestExam.rightEye}}</text>
              <text>å·¦çœ¼: {{currentCustomer.latestExam.leftEye}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
