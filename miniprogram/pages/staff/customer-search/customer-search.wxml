<!-- pages/staff/customer-search/customer-search.wxml -->
<view class="customer-search-container">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        type="number" 
        maxlength="11"
        placeholder="è¾“å…¥æ‰‹æœºå·æœç´¢å®¢æˆ·" 
        bindinput="onSearchInput"
        bindconfirm="doSearch"
        value="{{searchPhone}}"
        focus="{{!showAll}}"
      />
      <view class="clear-btn" bindtap="clearSearch" wx:if="{{searchPhone}}">Ã—</view>
    </view>
    <button class="search-btn" bindtap="doSearch">æœç´¢</button>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="result-section" wx:if="{{searchResult}}">
    <view class="customer-card">
      <view class="customer-header">
        <view class="customer-avatar">{{searchResult.name ? searchResult.name[0] : 'å®¢'}}</view>
        <view class="customer-info">
          <text class="customer-name">{{searchResult.name || 'æœªè®¾ç½®å§“å'}}</text>
          <text class="customer-phone">{{searchResult.phone}}</text>
        </view>
      </view>
      <view class="customer-stats">
        <view class="stat-item">
          <text class="stat-value">Â¥{{searchResult.balance}}</text>
          <text class="stat-label">ä½™é¢</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{searchResult.points}}</text>
          <text class="stat-label">ç§¯åˆ†</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{searchResult.examCount}}</text>
          <text class="stat-label">éªŒå…‰æ¬¡æ•°</text>
        </view>
      </view>
      <view class="customer-actions">
        <button class="action-btn exam-btn" bindtap="addExam" data-id="{{searchResult._id}}">
          <text>ğŸ“‹ æ·»åŠ éªŒå…‰</text>
        </button>
        <button class="action-btn recharge-btn" bindtap="rechargeCustomer" data-id="{{searchResult._id}}">
          <text>ğŸ’° å……å€¼</text>
        </button>
      </view>
    </view>
    
    <!-- éªŒå…‰å†å² -->
    <view class="exam-history" wx:if="{{searchResult.examRecords.length > 0}}">
      <view class="section-header">
        <text class="section-title">éªŒå…‰è®°å½•</text>
      </view>
      <view class="exam-list">
        <view class="exam-item" wx:for="{{searchResult.examRecords}}" wx:key="_id">
          <view class="exam-date">{{item.examDate}}</view>
          <view class="exam-data">
            <text>å³çœ¼: {{item.rightEye.sphere}} | å·¦çœ¼: {{item.leftEye.sphere}}</text>
          </view>
          <view class="exam-optometrist">éªŒå…‰å¸ˆ: {{item.optometrist}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœªæ‰¾åˆ° -->
  <view class="not-found" wx:if="{{showNotFound}}">
    <text class="not-found-icon">ğŸ˜•</text>
    <text class="not-found-text">æœªæ‰¾åˆ°è¯¥æ‰‹æœºå·çš„å®¢æˆ·</text>
    <text class="not-found-tip">è¯·ç¡®è®¤æ‰‹æœºå·æ˜¯å¦æ­£ç¡®</text>
  </view>

  <!-- å®¢æˆ·åˆ—è¡¨ -->
  <view class="customer-list-section" wx:if="{{showAll && customerList.length > 0}}">
    <view class="section-header">
      <text class="section-title">å…¨éƒ¨å®¢æˆ·</text>
      <text class="customer-count">å…± {{customerList.length}} ä½</text>
    </view>
    <view class="customer-list">
      <view class="customer-item" wx:for="{{customerList}}" wx:key="_id" bindtap="viewCustomer" data-customer="{{item}}">
        <view class="customer-avatar small">{{item.name ? item.name[0] : 'å®¢'}}</view>
        <view class="customer-info">
          <text class="customer-name">{{item.name || 'æœªè®¾ç½®å§“å'}}</text>
          <text class="customer-phone">{{item.phone}}</text>
        </view>
        <view class="customer-meta">
          <text class="days-ago {{item.daysAgo >= 90 ? 'warning' : ''}}">{{item.daysAgo}}å¤©å‰éªŒå…‰</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!searchResult && !showNotFound && (!showAll || customerList.length === 0)}}">
    <text class="empty-icon">ğŸ”</text>
    <text class="empty-text">è¾“å…¥æ‰‹æœºå·æœç´¢å®¢æˆ·</text>
  </view>
</view>
