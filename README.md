# 明亮眼镜店微信小程序

眼镜店会员管理与服务小程序 - 一套完整的眼镜店数字化解决方案，包含客户端和店员端。

## 📱 功能概览

### 客户端功能

1. **用户登录与注册**
   - 支持手机号验证码登录
   - 支持微信快捷授权登录

2. **首页**
   - 视力测试入口
   - 每日抽奖入口
   - 会员卡余额展示
   - 我的奖品快捷查看
   - 店铺活动/文章推送

3. **视力测试小游戏**
   - E视力表测试，适应不同屏幕大小
   - 选择左眼/右眼/双眼测试
   - 不同大小和方向的E字识别
   - 自动计算视力等级
   - 保存最后一次测试结果

4. **每日抽奖**
   - 每天一次免费抽奖机会
   - 奖品3天有效期
   - 奖品包括：全场8折券、免费清洗、眼镜布、眼镜盒、积分等
   - 我的奖品列表管理

5. **我的档案**
   - 验光记录查看（专业验光师记录）
   - 自测记录查看（最后一次）
   - 历史验光记录追溯

6. **个人中心**
   - 个人资料查看编辑
   - 积分余额查看
   - 会员卡展示
   - 付款二维码（密码保护，5分钟刷新）
   - 会员充值入口

### 店员端功能

1. **店员登录/注册**
   - 注册需管理员审核
   - 手机号密码登录

2. **工作台首页**
   - 本月业绩统计（营业额、充值金额、服务客户数、验光次数）
   - 今日业务统计
   - 快捷功能入口
   - 待跟进客户提醒（90天未验光）

3. **扫码核销**
   - 扫描客户付款码
   - 查看客户余额和可用奖品
   - 核销奖品
   - 扣除余额

4. **客户搜索**
   - 手机号快速检索
   - 查看客户详情和验光记录

5. **添加验光记录**
   - 录入专业验光数据
   - 保留历史验光记录

6. **客户充值**
   - 多档位充值套餐
   - 自定义充值金额
   - 充值赠送优惠

### 管理员功能

1. **店员审核**
   - 审核店员注册申请

2. **客户管理**
   - 查看所有客户信息
   - 查看客户余额和验光记录

3. **数据统计**
   - 全店数据概览

## 📋 所需材料

在使用本小程序前，您需要准备以下材料：

| 材料 | 说明 | 获取方式 |
|------|------|----------|
| 微信小程序AppID | 小程序唯一标识 | 微信公众平台注册 |
| 云开发环境 | 后端服务 | 微信开发者工具开通 |
| 营业执照 | 小程序主体认证 | 工商局办理 |
| 小程序类目 | 建议选择"生活服务-眼镜店" | 微信公众平台设置 |
| SSL证书（可选） | 如需自定义域名 | 云服务商购买 |

### 认证要求

- **个人主体**：部分功能受限，不推荐
- **企业主体**：需营业执照，推荐
- **认证费用**：300元/年（微信官方收取）

## 💰 费用估算

### 一次性费用

| 项目 | 费用 | 说明 |
|------|------|------|
| 小程序认证 | 300元 | 每年需续费 |
| 设计素材 | 0-500元 | 可使用提供的默认样式 |
| **合计** | **约300-800元** | |

### 运营费用（每月）

| 项目 | 费用 | 说明 |
|------|------|------|
| 云开发基础版 | 免费 | 适合小型店铺 |
| 云开发专业版 | 19.9元起 | 更大容量和并发 |
| 短信验证码 | 约0.05元/条 | 按使用量计费 |
| **合计** | **0-50元/月** | |

### 扩展功能费用（可选）

| 项目 | 费用 | 说明 |
|------|------|------|
| 微信支付 | 0.6%手续费 | 如开通在线充值 |
| 公众号关联 | 免费 | 推送文章功能 |
| 自定义域名 | 约100元/年 | 非必需 |

## 🚀 使用方法

### 第一步：注册小程序并获取AppID

1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 点击"立即注册" → 选择"小程序"
3. 按提示填写信息完成注册（建议使用企业主体）
4. 注册完成后，进入小程序管理后台
5. 在左侧菜单找到"开发管理" → "开发设置"
6. 在"开发者ID"区域找到并复制您的 **AppID（小程序ID）**

### 第二步：下载开发工具

1. 下载并安装 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 使用微信扫码登录开发者工具

### 第三步：导入项目

> ⚠️ **重要提示**：请导入本项目的**根目录**，而不是 `miniprogram` 文件夹！
> 
> 如果只导入 `miniprogram` 文件夹，将无法在开发者工具中看到 `cloud` 云函数目录。

1. 打开微信开发者工具
2. 点击"+"号或"导入项目"
3. **选择本项目的根目录**（包含 `miniprogram`、`cloud`、`docs` 等文件夹的目录）
4. 在AppID输入框中填入您在第一步获取的 **AppID**
5. 后端服务选择"微信云开发"
6. 点击"导入"

导入成功后，您应该能在开发者工具的项目目录中看到：
- 📁 `miniprogram` - 小程序前端代码
- 📁 `cloud/functions` - 云函数代码（显示云朵图标 ☁️）

### 第四步：配置云开发

1. 在开发者工具中点击"云开发"按钮
2. 开通云开发，创建环境
3. 修改 `miniprogram/app.js` 中的环境ID：
   ```javascript
   wx.cloud.init({
     env: 'your-env-id', // 替换为您的云开发环境ID
     traceUser: true,
   });
   ```

### 第五步：部署云函数

1. 右键点击 `cloud/functions` 下的每个云函数文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

### 第六步：创建数据库集合

在云开发控制台创建以下集合：
- `users` - 用户表
- `staff` - 店员表
- `exam_records` - 验光记录表
- `self_test_records` - 自测记录表
- `lottery_records` - 抽奖记录表
- `recharge_records` - 充值记录表
- `consume_records` - 消费记录表
- `verify_records` - 核销记录表
- `qrcode_tokens` - 二维码Token表
- `payment_orders` - 支付订单表

详细字段说明请参考 `docs/database-schema.md`

### 第七步：配置管理员

1. 先以店员身份注册一个账号
2. 在云开发控制台的 `staff` 集合中
3. 找到刚注册的记录，修改：
   - `role` 改为 `admin`
   - `isApproved` 改为 `true`

### 第八步：真机预览

1. 点击开发者工具的"预览"按钮
2. 使用手机微信扫描二维码预览

### 第九步：正式发布

1. 点击"上传"按钮提交代码
2. 登录微信公众平台
3. 进入"版本管理"提交审核
4. 审核通过后发布上线

## 📁 项目结构

```
├── project.config.json          # 项目配置文件（重要！）
├── miniprogram/                 # 小程序前端代码
│   ├── app.js                   # 应用入口
│   ├── app.json                 # 应用配置
│   ├── app.wxss                 # 全局样式
│   ├── pages/                   # 页面目录
│   │   ├── index/               # 首页
│   │   ├── login/               # 登录页
│   │   ├── vision-test/         # 视力测试
│   │   ├── lottery/             # 抽奖页
│   │   ├── records/             # 档案页
│   │   ├── profile/             # 个人中心
│   │   ├── qrcode/              # 付款码页
│   │   ├── staff/               # 店员端页面
│   │   │   ├── login/           # 店员登录
│   │   │   ├── index/           # 店员工作台
│   │   │   ├── scanner/         # 扫码核销
│   │   │   ├── customer-search/ # 客户搜索
│   │   │   ├── add-exam/        # 添加验光
│   │   │   └── recharge/        # 客户充值
│   │   └── admin/               # 管理员页面
│   │       ├── index/           # 管理后台
│   │       ├── staff-approval/  # 店员审核
│   │       └── customer-management/ # 客户管理
│   ├── utils/                   # 工具函数
│   ├── components/              # 自定义组件
│   └── images/                  # 图片资源
├── cloud/                       # 云函数目录
│   └── functions/
│       ├── login/               # 登录云函数
│       ├── lottery/             # 抽奖云函数
│       ├── records/             # 记录云函数
│       ├── staff/               # 店员云函数
│       ├── admin/               # 管理云函数
│       ├── qrcode/              # 二维码云函数
│       └── payment/             # 支付云函数
└── docs/                        # 文档目录
    └── database-schema.md       # 数据库结构说明
```

## ⚠️ 注意事项

1. **数据安全**：请定期备份云数据库数据
2. **密码存储**：生产环境请使用加密存储密码
3. **短信验证**：需对接短信服务商API
4. **微信支付**：需在微信商户平台申请
5. **隐私合规**：需在小程序设置中配置隐私协议

## ❓ 常见问题

### Q: 导入项目后看不到 cloud 云函数文件夹？

**A:** 这是因为导入了错误的目录。请确保：
1. 导入的是项目**根目录**（包含 `project.config.json` 的文件夹）
2. 不要只导入 `miniprogram` 文件夹
3. 导入时后端服务选择"微信云开发"

如果已经导入错误，请删除项目后重新导入正确的目录。

### Q: 提示 AppID 不正确？

**A:** 请检查：
1. 确保在微信公众平台注册的是"小程序"而非"公众号"
2. 复制的是 AppID（小程序ID）而非 AppSecret
3. 开发者工具已使用小程序管理员或开发者微信登录

### Q: 云函数部署失败？

**A:** 请检查：
1. 是否已开通云开发环境
2. 网络是否正常连接
3. 尝试右键云函数文件夹 → 选择"上传并部署：云端安装依赖"

## 🔧 自定义配置

### 修改店铺名称

修改 `miniprogram/app.json` 中的 `navigationBarTitleText`

### 修改主题颜色

修改 `miniprogram/app.wxss` 中的颜色变量

### 修改抽奖奖品

修改 `cloud/functions/lottery/index.js` 中的 `PRIZES` 配置

### 修改充值套餐

修改 `cloud/functions/payment/index.js` 中的 `RECHARGE_OFFERS` 配置

## 📞 技术支持

如有问题，请提交 Issue 或联系开发者。

## 📄 许可证

MIT License

---

**明亮眼镜店** - 让每一位顾客看得更清晰 👓
